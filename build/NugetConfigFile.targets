<Project ToolsVersion="15.0">
  <Target Name="WriteNugetConfigFile">

      <ItemGroup>
        <NugetConfigPrivateFeeds Include="$(ExternalRestoreSources.Split(';'))" />
      </ItemGroup>

    <PropertyGroup>
      <NugetConfigHeader>
        <![CDATA[
<?xml version="1.0" encoding="utf-8"?>
<configuration>
<packageSources>
<!--To inherit the global NuGet package sources remove the <clear/> line below -->
<clear />
        ]]>
      </NugetConfigHeader>

      <NugetConfigCLIFeeds>
        <![CDATA[
    <add key="myget-vstest" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
    <add key="BlobFeed" value="https://dotnetfeed.blob.core.windows.net/dotnet-core/index.json" />
    <add key="dotnet-core" value="https://dotnetmygetlegacy.blob.core.windows.net/dotnet-core/index.json" />
    <add key="aspnetcore-dev" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
    <add key="templating" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
    <add key="websdk" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
    <add key="roslyn" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
    <add key="nuget-build" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
    <add key="dotnet-public" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-public/nuget/v3/index.json" />
    <add key="container-tools" value="https://www.myget.org/F/container-tools-for-visual-studio/api/v3/index.json" />
    <add key="linux-musl-bootstrap-feed" value="https://dotnetfeed.blob.core.windows.net/orchestrated-release-2-1/20180420-03/aspnet-inputs/index.json" />
    <add key="dotnet-msbuild" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
    <add key="myget-vstest" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
    <add key="BlobFeed-2.1.3-runtime" value="https://dotnetfeed.blob.core.windows.net/orchestrated-release-2-1/20180725-02/final/index.json"/>
    <add key="fsharp" value="https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json" />
        ]]>
      </NugetConfigCLIFeeds>

      <NugetConfigSuffix>
        <![CDATA[
</packageSources>
<disabledPackageSources>
   <clear/>
</disabledPackageSources>
</configuration>
        ]]>
      </NugetConfigSuffix>

  </PropertyGroup>

    <WriteLinesToFile File="$(GeneratedNuGetConfig)"
                      Lines="$(NugetConfigHeader)"
                      Overwrite="true" />

    <WriteLinesToFile Condition="'$(ExternalRestoreSources)' != ''"
                      File="$(GeneratedNuGetConfig)"
                      Lines="&lt;add key=&quot;PrivateBlobFeed%(NugetConfigPrivateFeeds.Identity)&quot; value=&quot;%(NugetConfigPrivateFeeds.Identity)&quot; /&gt;"
                      Overwrite="false" />

    <WriteLinesToFile Condition="'$(DotNetBuildOffline)' != 'true'"
                      File="$(GeneratedNuGetConfig)"
                      Lines="$(NugetConfigCLIFeeds)"
                      Overwrite="false" />

    <WriteLinesToFile File="$(GeneratedNuGetConfig)"
                      Lines="$(NugetConfigSuffix)"
                      Overwrite="false" />

  </Target>
</Project>
